<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Tap Frenzy</title>

<style>
* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

body {
  margin: 0;
  background: linear-gradient(135deg, #1e1e1e, #121212);
  color: white;
  font-family: system-ui, Arial, sans-serif;
  text-align: center;
}

h1 {
  margin-top: 20px;
}

#info {
  display: flex;
  justify-content: space-around;
  margin: 10px;
  font-size: 18px;
}

#tapArea {
  margin: 20px auto;
  width: 85vw;
  height: 55vh;
  background: #ff4757;
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  font-weight: bold;
  user-select: none;
}

#tapArea:active {
  transform: scale(0.98);
}

button {
  margin: 15px;
  padding: 12px 26px;
  font-size: 18px;
  border-radius: 12px;
  border: none;
  background: #1e90ff;
  color: white;
  cursor: pointer;
}

button:hover {
  opacity: 0.9;
}

#leaderboard {
  margin: 20px auto;
  text-align: left;
  max-width: 320px;
}
</style>

<!-- Firebase COMPAT SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore-compat.js"></script>
</head>

<body>

<h1>ğŸ”¥ Tap Frenzy ğŸ”¥</h1>

<div id="info">
  <div>â± Time: <span id="time">10</span>s</div>
  <div>ğŸ¯ Score: <span id="score">0</span></div>
</div>

<div id="tapArea">TAP!</div>
<button onclick="startGame()">Start Game</button>

<div id="leaderboard"></div>

<script>
/* ================= FIREBASE INIT ================= */

const firebaseConfig = {
  apiKey: "AIzaSyDRJdaWQEbB7PzA8oH4xSG8lWuBUtCCa5s",
  authDomain: "tap-frenzy-9b5f4.firebaseapp.com",
  projectId: "tap-frenzy-9b5f4",
  storageBucket: "tap-frenzy-9b5f4.appspot.com",
  messagingSenderId: "938291260652",
  appId: "1:938291260652:web:118d14682b38e3f2f8c9c9"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ================= GAME LOGIC ================= */

let score = 0;
let timeLeft = 10;
let timer = null;
let gameRunning = false;

const tapArea = document.getElementById("tapArea");
const scoreEl = document.getElementById("score");
const timeEl = document.getElementById("time");
const leaderboardEl = document.getElementById("leaderboard");

tapArea.addEventListener("touchstart", tap, { passive: true });
tapArea.addEventListener("click", tap);

function tap() {
  if (!gameRunning) return;
  score++;
  scoreEl.textContent = score;
}

function startGame() {
  if (gameRunning) return;

  score = 0;
  timeLeft = 10;
  gameRunning = true;

  scoreEl.textContent = score;
  timeEl.textContent = timeLeft;
  tapArea.textContent = "GO!";

  timer = setInterval(() => {
    timeLeft--;
    timeEl.textContent = timeLeft;

    if (timeLeft <= 0) endGame();
  }, 1000);
}

function endGame() {
  clearInterval(timer);
  gameRunning = false;
  tapArea.textContent = "TIME UP!";

  setTimeout(() => {
    const name = prompt("Enter your name (max 20 chars):");
    if (!name) return;

    const cleanName = name.trim().substring(0, 20);
    if (cleanName) saveScore(cleanName, score);
  }, 200);
}

/* ================= FIRESTORE LEADERBOARD ================= */

function saveScore(name, score) {
  db.collection("scores").add({
    name,
    score,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  }).catch(err => {
    console.error(err);
    alert("Failed to save score.");
  });
}

function renderLeaderboard() {
  leaderboardEl.innerHTML = "<h3>ğŸ† Leaderboard</h3><p>Loading...</p>";

  db.collection("scores")
    .orderBy("score", "desc")
    .limit(10)
    .onSnapshot(snapshot => {
      let html = "<h3>ğŸ† Leaderboard</h3>";

      if (snapshot.empty) {
        html += "<p>No scores yet</p>";
      } else {
        snapshot.forEach((doc, i) => {
          const s = doc.data();
          html += `<p>${i + 1}. <strong>${s.name}</strong> â€“ ${s.score}</p>`;
        });
      }

      leaderboardEl.innerHTML = html;
    });
}

renderLeaderboard();
</script>

</body>
</html>
